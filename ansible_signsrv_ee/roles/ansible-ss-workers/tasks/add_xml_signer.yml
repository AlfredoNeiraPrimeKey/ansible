---

- name: Prepare Microsoft code timestamp signer properties file for SignServer
  template:
    src: xmlsigner.properties.j2
    dest: "{{ signsrv_home }}/conf/xmlsigner-{{ item.id }}.properties"
    owner: "{{ signsrv_user }}"
    group: "{{ signsrv_group }}"
    mode: 0640
  loop: "{{ xml_signers }}"
  loop_control:
    label: "{{ item.name }}"

- name: Add Microsoft code timestamp signer to SignServer
  command: "{{ signsrv_home }}/bin/signserver setproperties {{ signsrv_home }}/conf/xmlsigner-{{ item.id }}.properties"
  args:
    chdir: "{{ signsrv_home }}"
  environment:
    APPSRV_HOME: "{{ wildfly_home }}"
  become: yes
  become_user: "{{ signsrv_user }}"
  loop: "{{ xml_signers }}"
  loop_control:
    label: "{{ item.name }}"

- name: Reload SignServer
  command: "{{ signsrv_home }}/bin/signserver reload {{ item.name }}"
  args:
    chdir: "{{ signsrv_home }}"
  environment:
    APPSRV_HOME: "{{ wildfly_home }}"
  become: yes
  become_user: "{{ signsrv_user }}"
  loop: "{{ xml_signers }}"
  loop_control:
    label: "{{ item.name }}"